import{o as e,r as t,T as r,h as s,l as i,S as n,a,b as c,c as o,d as u,e as d}from"./vendor.c8526b5e.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(r){const s=new URL(e,location),i=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((r,n)=>{const a=new URL(e,s);if(self[t].moduleMap[a])return r(self[t].moduleMap[a]);const c=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),o=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){n(new Error(`Failed to import: ${e}`)),i(o)},onload(){r(self[t].moduleMap[a]),i(o)}});document.head.appendChild(o)})),self[t].moduleMap={}}}("/assets/");const l=[];var p,m,f=e((function({spreadsProvider:e}){const i=function(){const[e,r]=t.useReducer((e=>e+1),0);return r}();if(t.useEffect((()=>{setInterval(i,1e3)}),[]),0===e.spreadRank.length)return t.createElement("div",null,"loading...");const n=[{title:"Symbol",dataIndex:"symbol",key:"symbol",align:"right",width:1},{title:"Spot",dataIndex:"currentPrice",key:"currentPrice",align:"right"},{title:"Future",dataIndex:"futurePrice",key:"futurePrice",align:"right"},{title:"Diff Rate",dataIndex:"diffRate",key:"diffRate",align:"right"},{title:"APY",dataIndex:"diffRateAnnual",key:"diffRateAnnual",align:"right"}],a=Array.from(e.groupedSpreadRank.entries()).map((([e,i])=>{const a=function(e){const t=s();return s("20"+e).diff(t,"days")}(e),c=i.map((({symbol:e,currentPrice:t,futurePrice:r,diffRate:s})=>({symbol:e.toUpperCase(),currentPrice:t.toFixed(3),futurePrice:r.toFixed(3),diffRate:`${(100*s).toFixed(2)}%`,diffRateAnnual:`${(s/(a/365)*100).toFixed(2)}%`})));return t.createElement(r,{key:e,style:{width:600,marginBottom:30},pagination:!1,size:"small",title:()=>`${e} ( ~${a}d. / ${(a/30).toFixed(1)}m. )`,columns:n,dataSource:c,rowKey:"symbol",rowClassName:e=>{return t=e.symbol,l.find((e=>t.startsWith(e)))?"highlight":"";var t}})}));return t.createElement(t.Fragment,null,a)}));(m=p||(p={})).CURRENT="CURRENT",m.FUTURE="FUTURE";var h,y,R=Object.defineProperty,b=Object.getOwnPropertyDescriptor,P=(e,t,r,s)=>{for(var i,n=s>1?void 0:s?b(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(n=(s?i(t,r,n):i(n))||n);return s&&n&&R(t,r,n),n};(y=h||(h={})).UPDATE_CURRENT_PRICE="UPDATE_CURRENT_PRICE",y.UPDATE_FUTURE_PRICE="UPDATE_FUTURE_PRICE";class g{constructor(e){this._currentPrice=0,this._futurePrice=0,this.diffRate=0,this.symbol=e}get currentPrice(){return this._currentPrice}set currentPrice(e){this._currentPrice=e,this.diffRate=(this._futurePrice-this._currentPrice)/this._currentPrice}get futurePrice(){return this._futurePrice}set futurePrice(e){this._futurePrice=e,this.diffRate=(this._futurePrice-this._currentPrice)/this._currentPrice}}class E{constructor(e){this.spreads=new Map;const t=this.updateCurrentPrice.bind(this);e.currentPrice$.subscribe({next({symbol:e,price:r}){t(e,r)}});const r=this.updateFuturePrice.bind(this);e.futurePrice$.subscribe({next({symbol:e,price:t}){r(e,t)}})}get spreadRank(){return i.reverse(i.sortBy(Array.from(this.spreads.values()).filter((e=>e.diffRate!==1/0)),"diffRate"))}get groupedSpreadRank(){return this.spreadRank.reduce(((e,t)=>{const r=t.symbol.split("_")[1];return e.get(r)||e.set(r,[]),e.get(r).push(t),e}),new Map)}updateCurrentPrice(e,t){const r=e.slice(0,-1);Array.from(this.spreads.keys()).filter((e=>e.startsWith(r))).forEach((e=>{this.spreads.get(e).currentPrice=t}))}updateFuturePrice(e,t){this.spreads.has(e)||this.spreads.set(e,new g(e)),this.spreads.get(e).futurePrice=t}}P([c],E.prototype,"spreads",2),P([o],E.prototype,"spreadRank",1),P([o],E.prototype,"groupedSpreadRank",1),P([u],E.prototype,"updateCurrentPrice",1),P([u],E.prototype,"updateFuturePrice",1);const U=new E(new class{constructor(){this.currentWsClient=new WebSocket("wss://stream.binance.com/ws"),this.futureWsClient=new WebSocket("wss://dstream.binance.com/ws"),this.readys=0,this.requestId=0,this.currentPrice$=this._initSubject(p.CURRENT,this.currentWsClient),this.futurePrice$=this._initSubject(p.FUTURE,this.futureWsClient)}_initSubject(e,t){const r=new n;return t.addEventListener("open",(()=>{this.readys++,2===this.readys&&this.generateAllFCPairs()})),t.addEventListener("error",(e=>r.error(e))),t.addEventListener("close",(()=>r.complete())),e===p.CURRENT?t.addEventListener("message",(e=>{const t=JSON.parse(e.data);if(null===t.result)return;const s=t,i={symbol:s.s.toLowerCase(),price:parseFloat(s.p),tradeTime:s.T,eventTime:s.E};r.next(i)})):e===p.FUTURE&&t.addEventListener("message",(e=>{const t=JSON.parse(e.data);if(null===t.result)return;const s=t,i={symbol:s.s.toLowerCase(),price:parseFloat(s.p),tradeTime:s.T,eventTime:s.E};r.next(i)})),r}async _fetchAllSupportedSymbols(){return(await a.get("https://dapi.binance.com/dapi/v1/ticker/price")).data.filter((e=>function(e){const t=e.split("_");if(2!==t.length)return!1;const r=parseInt(t[1]);return!(Number.isNaN(r)||!i.isNumber(r))}(e.symbol)))}_subscribeTicker(e,t){const r=e===p.FUTURE?this.futureWsClient:this.currentWsClient,s={method:"SUBSCRIBE",params:t,id:this.requestId++};console.log("[subscribeTicker] type:",e,"payload:",s),r.send(JSON.stringify(s))}async generateAllFCPairs(){const e=(await this._fetchAllSupportedSymbols()).map((e=>({currentSymbol:`${e.ps}T`.toLowerCase(),futureSymbol:e.symbol.toLowerCase()})));console.log(e),this._subscribeTicker(p.CURRENT,e.map((e=>e.currentSymbol+"@aggTrade"))),this._subscribeTicker(p.FUTURE,e.map((e=>e.futureSymbol+"@aggTrade")))}});function _(){return t.createElement("div",{className:"App",style:{padding:10}},t.createElement(f,{spreadsProvider:U}))}d.render(t.createElement(t.StrictMode,null,t.createElement(_,null)),document.getElementById("root"));
//# sourceMappingURL=index.e504fb85.js.map
